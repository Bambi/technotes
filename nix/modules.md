## Modules
Can be used with NixOS and home-manager. They allow to define new options
(user-defined data to add to the standard schema).
A module is either an attribute set or a function accepting an attribute set.
A module consist of:
- an `imports` attribute, allowing to compose this module from other smaller modules.
  List of path to other modules. Modules receive has parameters (at least):
  - `lib`: the nixpkg library
  - `config`: the final configuration of all modules
  - `options`: options declared in all modules
  - `pkgs`: nixpkgs packages
- an `options` attribute, which declares settings users of this module can use.
  There is usualy a `enable` option.
- a `config` attribute which what to do with theses options. It define what
  other settings, services and resources should be active and should be dependant
  of the `enable` option.
See [Wiki](https://nixos.wiki/wiki/NixOS_modules) for details.
```nix
{ config, pkgs, ... }: {
  imports =
    [ paths of other modules
    ];

  options = {
    # option declarations
  };

  config = {
    # option definitions
  };
}
```
### Abbreviated Form
A module that define only options can be written like this:
```nix
{ config, pkgs, ... }: {
  imports =
    [ paths of other modules
    ];

  # option definitions
}
```
No need to put your option definitions into the `config` attribute set.
See [here](https://nixos.org/manual/nixos/stable/index.html#sec-writing-modules).

### NixOS Modules
A Nix Module can be an attribute set, or a function that
returns an attribute set. By default, if a Nix Module is a
function, this function have the following default parameters:
- lib: the nixpkgs function library, which provides many
  useful functions for operating Nix expressions:
  https://nixos.org/manual/nixpkgs/stable/#id-1.4
- config: all config options of the current flake, very useful
- options: all options defined in all NixOS Modules
  in the current flake.
- pkgs: a collection of all packages defined in nixpkgs,
  plus a set of functions related to packaging.
  You can assume its default value is
  `nixpkgs.legacyPackages."${system}"` for now.
  Can be customed by `nixpkgs.pkgs` option.
- modulesPath: the default path of nixpkgs's modules folder,
  used to import some extra modules from nixpkgs.

The default parameters mentioned above are automatically generated by Nixpkgs. 
However, if you need to pass other non-default parameters to the submodules, 
you'll have to manually configure these parameters using `specialArgs`.
In particular this is used to pass the `input` parameter which is not automatically
generated.

### [Import](https://book.divnix.com/ch05-03-imports-and-callpackage.html)
Allows for a file to be read and evaluated. If a directory is passed to import,
then it will assume `<directory>/default.nix` was the desired file.
The general syntax is: `import <file> [parameters list]`.
Examples:
```nix
# for a function with no parameter:
import ./hello;  # or
import ./hello {};
# for a function with one param:
import ./hello pkgs
# for a function with an attr-set param:
import ./hello { inherit config pkgs; myOption = val; }
```
Each time we import a file we need to provide all the required parameters.

### pkgs.callPackage
It is a wrapper arround `import` that
allows us to import a file without providing all the parameters: callPackage
will provide the missing parameters. Example for the previous import:
```nix
pkgx.callPackage ./hello { myOption = val; }
```

### `imports` attribute vs builtins import vs `modules` attribute
The `imports` attribute of modules and the `import` function are differents:
The imports attribute expect a file with a NixOS module (see [modules] its structure)
while the builtins import can load any Nix function.
The `imports` attribute should only be used inside a module.

The `modules` attribute should NOT be used in modules. It should be used outside
of modules to import modules (it make the imported file a module).

### Passing Arguments With 'imports'
It is possible to pass arguments to imported modules. For example this module:
```nix
{ lib, withFoo?"bar, ..." }: { ... }
```
Can be called with:
```nix
args@{ ... }:
{
  imports = [
    # ...
    (
      import ./foobar.nix (
        args
        // { withFoo = "baz"; }
      )
    )
    # ...
  ];
}  
```

### _module.args (passing arguments with modules)
Additional arguments passed to each module in addition to `lib`, `config`, `pkgs`...
```nix
{
  imports = [
    ./hello
    { _module.args = { myOption = val; }; } # or
    { _module.args.myOption = val; }
  ];
}
```
